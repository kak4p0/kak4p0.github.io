---
layout: page
# Place at: _layouts/categories.html
---

{% assign child_cats = "" | split: "" %}
{% for cat in site.categories %}
  {% assign cat_name = cat[0] %}
  {% assign cat_posts = cat[1] %}
  {% for other_cat in site.categories %}
    {% assign other_name = other_cat[0] %}
    {% if other_name == cat_name %}{% continue %}{% endif %}
    {% assign other_posts = other_cat[1] %}
    {% assign is_subset = true %}
    {% for p in cat_posts %}
      {% assign found = false %}
      {% for op in other_posts %}
        {% if op.url == p.url %}{% assign found = true %}{% break %}{% endif %}
      {% endfor %}
      {% unless found %}{% assign is_subset = false %}{% break %}{% endunless %}
    {% endfor %}
    {% if is_subset and cat_posts.size < other_posts.size %}
      {% unless child_cats contains cat_name %}
        {% assign child_cats = child_cats | push: cat_name %}
      {% endunless %}
      {% break %}
    {% endif %}
  {% endfor %}
{% endfor %}

{% assign top_pairs = "" | split: "" %}
{% for cat in site.categories %}
  {% assign cat_name = cat[0] %}
  {% unless child_cats contains cat_name %}
    {% assign cat_posts = cat[1] | sort: "date" | reverse %}
    {% assign latest = cat_posts | first %}
    {% assign p = latest.date | date: "%Y%m%d" | append: "|" | append: cat_name %}
    {% assign top_pairs = top_pairs | push: p %}
  {% endunless %}
{% endfor %}
{% assign top_pairs = top_pairs | sort | reverse %}

{% for pair in top_pairs %}
  {% assign cat_name = pair | split: "|" | last %}
  {% assign cat_posts = site.categories[cat_name] | sort: "date" | reverse %}

  {% assign my_children_pairs = "" | split: "" %}
  {% for child_name in child_cats %}
    {% assign child_posts = site.categories[child_name] %}
    {% assign is_my_child = true %}
    {% for cp in child_posts %}
      {% assign found = false %}
      {% for pp in cat_posts %}
        {% if pp.url == cp.url %}{% assign found = true %}{% break %}{% endif %}
      {% endfor %}
      {% unless found %}{% assign is_my_child = false %}{% break %}{% endunless %}
    {% endfor %}
    {% if is_my_child %}
      {% assign cs = child_posts | sort: "date" | reverse %}
      {% assign cl = cs | first %}
      {% assign cp2 = cl.date | date: "%Y%m%d" | append: "|" | append: child_name %}
      {% assign my_children_pairs = my_children_pairs | push: cp2 %}
    {% endif %}
  {% endfor %}
  {% assign my_children_pairs = my_children_pairs | sort | reverse %}

  <div style="margin-bottom:2rem;">
    <div style="display:flex;align-items:center;gap:.6rem;padding:.6rem 0;border-bottom:2px solid rgba(160,160,175,.15);margin-bottom:.75rem;">
      <i class="far fa-folder-open" style="color:rgba(160,160,175,.50);font-size:1.1rem;"></i>
      <span style="color:rgba(255,255,255,.92);font-size:1.2rem;font-weight:700;">{{ cat_name }}</span>
      <span style="color:rgba(255,255,255,.30);font-size:.8rem;">{{ cat_posts | size }} posts</span>
    </div>

    {% if my_children_pairs.size > 0 %}
      {% for child_pair in my_children_pairs %}
        {% assign child_name = child_pair | split: "|" | last %}
        {% assign child_posts = site.categories[child_name] | sort: "date" | reverse %}
        {% assign child_latest = child_posts | first %}
        {% assign detail_id = child_name | slugify | prepend: "detail-" %}

        <!-- Sub-category row -->
        <div style="margin:0 0 .4rem 0;">
          <!-- Header: link + toggle icon -->
          <div style="display:flex;align-items:center;justify-content:space-between;padding:.65rem 1rem;background:rgba(24,24,28,.50);border:1px solid rgba(160,160,175,.10);border-radius:10px;">
            <!-- Left: category link (clickable → goes to category page) -->
            <a href="{{ site.baseurl }}/categories/{{ child_name | slugify | url_encode }}/"
               style="display:flex;align-items:center;gap:.5rem;color:rgba(255,255,255,.85);text-decoration:none;font-weight:500;flex:1;min-width:0;">
              <i class="far fa-folder" style="color:rgba(160,160,175,.40);font-size:.85rem;flex-shrink:0;"></i>
              <span style="overflow:hidden;text-overflow:ellipsis;white-space:nowrap;">{{ child_name }}</span>
              <span style="color:rgba(255,255,255,.30);font-size:.78rem;flex-shrink:0;">{{ child_posts | size }}</span>
              <span style="color:rgba(255,255,255,.22);font-size:.72rem;flex-shrink:0;margin-left:.15rem;">
                {{ child_latest.date | date: "%b %d" }}
              </span>
            </a>
            <!-- Right: toggle button -->
            <button onclick="var d=document.getElementById('{{ detail_id }}');if(d.style.display==='none'){d.style.display='block';this.textContent='▼'}else{d.style.display='none';this.textContent='▶'}"
                    style="background:none;border:1px solid rgba(160,160,175,.12);border-radius:6px;color:rgba(255,255,255,.35);font-size:.7rem;padding:.2rem .45rem;cursor:pointer;flex-shrink:0;margin-left:.5rem;line-height:1;">
              ▶
            </button>
          </div>

          <!-- Post list (hidden by default) -->
          <div id="{{ detail_id }}" style="display:none;">
            <ul style="list-style:none;margin:.3rem 0 .3rem 0;padding:0;">
              {% for post in child_posts %}
                <li style="display:flex;justify-content:space-between;align-items:center;padding:.35rem 1rem .35rem 2.2rem;border-bottom:1px solid rgba(160,160,175,.04);">
                  <a href="{{ post.url | relative_url }}" style="color:rgba(255,255,255,.72);text-decoration:none;font-size:.88rem;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;">
                    {{ post.title }}
                  </a>
                  <time style="color:rgba(255,255,255,.28);font-size:.74rem;white-space:nowrap;margin-left:.5rem;">
                    {{ post.date | date: "%b %d" }}
                  </time>
                </li>
              {% endfor %}
            </ul>
          </div>
        </div>
      {% endfor %}

    {% else %}
      {% for post in cat_posts %}
        <div style="display:flex;justify-content:space-between;align-items:center;padding:.4rem 1rem;border-bottom:1px solid rgba(160,160,175,.05);">
          <a href="{{ post.url | relative_url }}" style="color:rgba(255,255,255,.78);text-decoration:none;font-size:.9rem;">
            {{ post.title }}
          </a>
          <time style="color:rgba(255,255,255,.30);font-size:.76rem;white-space:nowrap;margin-left:.5rem;">
            {{ post.date | date: "%b %d, %Y" }}
          </time>
        </div>
      {% endfor %}
    {% endif %}
  </div>
{% endfor %}
