---
---
@import "main";

/* =========================================================
   Kak4p0 Kakapo Mint/Lime Skin (Chirpy)
   Goals:
   - cleaner + less blurry (no heavy backdrop-filter)
   - stronger identity (kakapo mint/lime)
   - fix: right panel dropping to bottom on long posts
   ========================================================= */

/* ---------- Palette ---------- */
:root{
  --k-mint: #2dd4bf;          /* mint */
  --k-lime: #a3e635;          /* lime */
  --k-ink:  #0a0f12;          /* deep bg */
  --k-ink2: #0d1417;          /* secondary bg */
  --k-surface: rgba(255,255,255,.035);
  --k-surface2: rgba(255,255,255,.05);
  --k-border: rgba(255,255,255,.08);
  --k-mint-border: rgba(45,212,191,.22);
  --k-lime-border: rgba(163,230,53,.22);
}

/* ---------- Background (distinct, but calm) ---------- */
body{
  background:
    radial-gradient(900px 650px at 14% -10%, rgba(45,212,191,.12), transparent 60%),
    radial-gradient(900px 650px at 86%  10%, rgba(163,230,53,.10), transparent 60%),
    linear-gradient(180deg, var(--k-ink), var(--k-ink2));
}

/* subtle “noise” layer: adds uniqueness without blur */
body::before{
  content:"";
  position: fixed;
  inset: 0;
  pointer-events: none;
  background:
    repeating-linear-gradient(0deg, rgba(255,255,255,.02), rgba(255,255,255,.02) 1px, transparent 1px, transparent 6px),
    repeating-linear-gradient(90deg, rgba(0,0,0,.03), rgba(0,0,0,.03) 1px, transparent 1px, transparent 8px);
  opacity: .25;
  mix-blend-mode: overlay;
}

/* ---------- Readability ---------- */
.post-content{
  line-height: 1.78;
  letter-spacing: .1px;
}
.post-content p{ margin-bottom: 1.05rem; }

/* Headings: kakapo accent bar */
.post-content h2,
.post-content h3{
  position: relative;
  padding-left: .75rem;
}
.post-content h2::before,
.post-content h3::before{
  content:"";
  position:absolute;
  left:0;
  top:.35em;
  width:.32rem;
  height: 1.1em;
  border-radius: 999px;
  background: linear-gradient(180deg, rgba(45,212,191,.9), rgba(163,230,53,.9));
  box-shadow: 0 0 16px rgba(45,212,191,.18);
}

/* Links: mint -> lime hover */
a,
.post-content a{
  color: var(--k-mint);
  text-decoration-thickness: 1px;
  text-underline-offset: 3px;
}
a:hover,
.post-content a:hover{
  color: var(--k-lime);
}

/* Selection */
::selection{ background: rgba(163,230,53,.22); }

/* ---------- Cards / Panels (less “fog”, more crisp) ---------- */
.card,
.card-wrapper,
#panel-wrapper .panel,
#core-wrapper .post,
#core-wrapper .page,
#core-wrapper .home{
  background: var(--k-surface) !important;
  border: 1px solid var(--k-border) !important;
  border-radius: 18px !important;
  box-shadow: 0 10px 30px rgba(0,0,0,.25);
}

/* Topbar: crisp line + slight tint */
#topbar-wrapper{
  background: rgba(0,0,0,.18) !important;
  border-bottom: 1px solid rgba(255,255,255,.06);
}
#topbar-wrapper a{ color: rgba(255,255,255,.78); }
#topbar-wrapper a:hover{ color: var(--k-lime); }

/* Sidebar: gradient + active glow */
#sidebar{
  background:
    radial-gradient(900px 650px at 30% 0%, rgba(45,212,191,.11), transparent 55%),
    radial-gradient(900px 650px at 70% 15%, rgba(163,230,53,.09), transparent 55%),
    linear-gradient(180deg, rgba(0,0,0,.10), rgba(0,0,0,.40));
  border-right: 1px solid rgba(255,255,255,.06);
}
#sidebar .nav-link.active{
  background: rgba(45,212,191,.14) !important;
  border: 1px solid rgba(163,230,53,.18) !important;
  box-shadow:
    0 0 0 1px rgba(45,212,191,.10) inset,
    0 12px 28px rgba(0,0,0,.35);
}

/* ---------- Tags / Chips ---------- */
.tag,
.post-tag,
#panel-wrapper .post-tag{
  border-radius: 999px !important;
  border: 1px solid rgba(45,212,191,.24) !important;
  background: rgba(45,212,191,.08) !important;
}
.tag:hover,
.post-tag:hover{
  border-color: rgba(163,230,53,.34) !important;
  background: rgba(163,230,53,.10) !important;
}

/* ---------- Code blocks (key for writeups) ---------- */
pre,
.highlight,
div.highlighter-rouge{
  background: rgba(0,0,0,.34) !important;
  border: 1px solid rgba(45,212,191,.18) !important;
  border-radius: 16px !important;
  box-shadow: 0 10px 26px rgba(0,0,0,.28);
  overflow-x: auto !important;      /* IMPORTANT: prevent layout stretching */
  max-width: 100% !important;       /* IMPORTANT: prevent right panel drop */
}
code{
  font-family: ui-monospace, "JetBrains Mono", "Cascadia Mono", "D2Coding", SFMono-Regular, Menlo, Consolas, monospace;
}

/* Long text / tables should not blow up width */
#core-wrapper,
.post-content{
  min-width: 0;                     /* IMPORTANT for flex layouts */
}
.post-content *{
  overflow-wrap: anywhere;
}
.post-content table{
  display: block;
  overflow-x: auto;
  max-width: 100%;
}
.post-content img,
.post-content video,
.post-content svg{
  max-width: 100%;
  height: auto;
}

/* ---------- Right panel stability (desktop) ----------
   If a long code/table forces the main column to exceed width,
   Bootstrap's row may wrap -> panel drops to bottom.
   Fix: force nowrap + min-width:0 (core can shrink) + fixed panel width.
   Also covers Chirpy layouts where #main-wrapper itself is .row. */
@media (min-width: 992px){
  /* Case A: #main-wrapper itself behaves like a Bootstrap row */
  #main-wrapper{
    display: flex !important;
    flex-wrap: nowrap !important;
    align-items: flex-start;
  }

  /* Case B: #main-wrapper contains the row */
  #main-wrapper > .row,
  #main-wrapper > .container > .row,
  #main-wrapper .row.flex-grow-1{
    display: flex !important;
    flex-wrap: nowrap !important;
    align-items: flex-start;
  }

  /* Critical: allow flex items to shrink even when content is long */
  #core-wrapper,
  #panel-wrapper,
  #main-wrapper > .row > *,
  #main-wrapper > .container > .row > *,
  #main-wrapper .row.flex-grow-1 > *{
    min-width: 0 !important;
  }

  /* Core takes remaining space (0-basis prevents min-content expansion) */
  #core-wrapper{
    flex: 1 1 0% !important;
    width: auto !important;
    min-width: 0 !important;
  }

  /* Panel fixed width so it never drops below */
  #panel-wrapper{
    flex: 0 0 320px !important;
    width: 320px !important;
    max-width: 320px !important;
    min-width: 320px !important;
    align-self: flex-start !important;
    margin-top: 0 !important;
  }

  /* Rouge line-number tables can still inflate min-content width */
  #core-wrapper .rouge-table{
    display: block;
    overflow-x: auto;
    max-width: 100%;
  }
}



/* =========================
   Wider layout on big screens (less "narrow" look)
   - Chirpy uses Bootstrap containers with max-width ~1320px on 2k monitors.
   - Increase main content max-width so core+panel can breathe.
   ========================= */
@media (min-width: 1400px){
  /* If #main-wrapper is used as the main container */
  #main-wrapper{
    width: 100%;
    max-width: 1480px; /* tweak: 1440~1600 */
    margin-left: auto;
    margin-right: auto;
  }

  /* If a Bootstrap .container wraps the row */
  #main-wrapper > .container,
  #main-wrapper .container{
    max-width: 1480px;
  }
}

/* =========================
   Sticky TOC only (Contents only follows while scrolling)
   - Keeps current-section highlight behavior (handled by Chirpy/tocbot JS)
   - Panel stays in normal flow; only TOC becomes sticky
   ========================= */
@media (min-width: 992px){
  /* Sticky can be disabled by overflow on ancestors; keep them visible */
  #main,
  #main-wrapper,
  #core-wrapper,
  #panel-wrapper{
    overflow: visible !important;
  }

  /* Ensure panel itself is NOT sticky */
  #panel-wrapper{
    position: static !important;
    top: auto !important;
    max-height: none !important;
    overflow: visible !important;
  }

  /* Make only the TOC sticky */
  #toc-wrapper,
  #panel-wrapper .toc-wrapper,
  #panel-wrapper .panel.toc-wrapper{
    position: sticky !important;
    top: 5.2rem; /* below topbar */
    align-self: flex-start !important;
    z-index: 2;
  }

  /* If TOC is long, scroll inside it */
  #toc-wrapper{
    max-height: calc(100vh - 6.2rem);
    overflow-y: auto;
  }
}



/* =========================
   List pages (categories/tags/archives) look "too narrow"
   Cause: panel column isn't being pushed to the far right on some layouts,
          and core keeps a constrained max-width.
   Fix: (1) push panel to the right, (2) let core expand, (3) widen #main container too.
   ========================= */

/* Wider container: Chirpy often uses #main as Bootstrap .container */
@media (min-width: 1400px){
  #main{
    max-width: 1480px !important; /* tweak 1440~1600 */
  }
}

/* Align panel to the far right and let core breathe */
@media (min-width: 992px){
  /* Top-level row variants */
  #main > .row,
  #main-wrapper > .row,
  #main-wrapper > .container > .row,
  #main-wrapper .row.flex-grow-1{
    flex-wrap: nowrap !important;
  }

  /* Core should occupy remaining width */
  #core-wrapper{
    flex: 1 1 0% !important;
    max-width: none !important;
    width: auto !important;
    min-width: 0 !important;
  }

  /* Panel always pinned to the far right (prevents "center-floating" look) */
  #panel-wrapper{
    margin-left: auto !important;
    flex: 0 0 320px !important;
    width: 320px !important;
    max-width: 320px !important;
    min-width: 320px !important;
  }
}


/* =========================
   Categories / Tags / Archives: core column is not #core-wrapper (Chirpy uses <main aria-label="Main Content">)
   Force the main row to behave as "fluid core + fixed panel" on ALL pages.
   ========================= */
@media (min-width: 992px){
  /* Chirpy main layout row */
  #main > .row.flex-grow-1{
    flex-wrap: nowrap !important;
  }

  /* Core column (used on list pages) */
  #main > .row.flex-grow-1 > main[aria-label="Main Content"]{
    flex: 1 1 0% !important;
    width: auto !important;
    max-width: none !important;
    min-width: 0 !important;
  }

  /* Panel pinned to the far right */
  #main > .row.flex-grow-1 > #panel-wrapper{
    margin-left: auto !important;
    flex: 0 0 320px !important;
    width: 320px !important;
    max-width: 320px !important;
    min-width: 320px !important;
  }
}

/* =========================
   Move Search to top-right (Topbar)
   - Keep breadcrumbs on the left
   - Push search wrapper to the far right
   ========================= */
@media (min-width: 992px){
  #topbar{
    display: flex !important;
    align-items: center;
    gap: .75rem;
  }

  /* Breadcrumb/Title side expands */
  #topbar #breadcrumb,
  #topbar nav[aria-label="Breadcrumb"],
  #topbar .breadcrumb,
  #topbar .topbar-title{
    flex: 1 1 auto;
    min-width: 0;
  }

  /* Search side sticks to the right */
  #topbar #search-wrapper,
  #topbar .search-wrapper,
  #topbar #search-trigger,
  #topbar #search{
    margin-left: auto !important;
  }

  /* Make the visible input a bit more "top-right" sized */
  #topbar #search-input{
    width: min(340px, 32vw);
  }
}


/* =========================
   FINAL OVERRIDES (v6)
   1) Make ALL pages (home/posts/categories/tags/archives/about) use the same wider container.
      - Your earlier rule only kicked in at >=1400px; with sidebar/topbar, the effective width can be <1400.
   2) Make TOC actually stick: stick the *TOC panel* (parent), not the inner #toc-wrapper,
      because sticky is constrained by parent height.
   ========================= */

/* 1) Wider container on desktop (applies earlier: wins) */
@media (min-width: 1200px){
  #main{
    width: 100% !important;
    max-width: 1480px !important; /* tweak 1440~1600 */
  }

  #main-wrapper{
    width: 100% !important;
  }

  #main-wrapper > .container,
  #main-wrapper .container{
    max-width: 1480px !important;
  }

  /* Main layout row should stretch full width */
  #main > .row.flex-grow-1{
    width: 100% !important;
    justify-content: space-between !important;
    flex-wrap: nowrap !important;
  }
}

/* 2) Sticky TOC panel (Contents follows + active section highlight remains) */
@media (min-width: 992px){
  /* Keep sticky from being killed by overflow on ancestors */
  #main,
  #main-wrapper,
  #core-wrapper,
  #panel-wrapper{
    overflow: visible !important;
  }

  /* Ensure the panel column itself stays in flow (not sticky) */
  #panel-wrapper{
    position: static !important;
  }

  /* Make the TOC *panel* sticky (not just inner wrapper) */
  #panel-wrapper .panel:has(#toc-wrapper),
  #panel-wrapper section:has(#toc-wrapper),
  #panel-wrapper div:has(> #toc-wrapper){
    position: sticky !important;
    top: 5.2rem; /* below topbar */
    align-self: flex-start !important;
    z-index: 3;
    max-height: calc(100vh - 6.2rem);
    overflow-y: auto;
  }

  /* Prevent double constraints from the inner wrapper */
  #toc-wrapper{
    position: static !important;
    top: auto !important;
    max-height: none !important;
    overflow: visible !important;
  }
}


/* =========================
   v7 overrides
   - Fix: TOC not sticking (was overridden elsewhere)
   - Fix: double "nested box" inside code blocks (styling applied to both wrapper + <pre>)
   ========================= */

/* TOC (Contents) should follow on post pages */
@media (min-width: 992px){
  /* keep ancestors from breaking sticky */
  html, body,
  #main-wrapper,
  #main,
  #panel-wrapper{
    overflow: visible !important;
  }

  /* IMPORTANT: sticky the actual Chirpy wrapper */
  section#toc-wrapper{
    position: sticky !important;
    top: 5.2rem !important;  /* below topbar */
    align-self: flex-start !important;
    z-index: 10;
    max-height: calc(100vh - 6.2rem);
    overflow-y: auto;
  }
}

/* Code blocks: style the wrapper, not the inner <pre> (prevents "inner box" covering code) */
div.highlighter-rouge,
figure.highlight,
div.highlight,
div.highlighter-rouge > div.highlight{
  background: rgba(0,0,0,.34) !important;
  border: 1px solid rgba(45,212,191,.18) !important;
  border-radius: 16px !important;
  box-shadow: 0 10px 26px rgba(0,0,0,.28) !important;
  overflow: hidden; /* keeps header/edges clean */
}

/* Neutralize inner <pre> so it doesn't draw a second box */
div.highlighter-rouge pre,
figure.highlight pre,
div.highlight pre,
div.highlighter-rouge div.highlight pre{
  background: transparent !important;
  border: none !important;
  box-shadow: none !important;
  border-radius: 0 !important;
  margin: 0 !important;
}

/* If rouge table is used (line numbers), remove extra spacing */
div.highlight table.rouge-table{
  margin: 0 !important;
}


/* =========================
   v8: Fix "Categories/Tags/Archives/About still too narrow"
   Root cause (from your DevTools): those pages are laid out under:
     #main-wrapper > .container > .row.flex-grow-1 > main[...] + aside#panel-wrapper
   There is no #main id there, so previous #main-based widening missed.
   Solution: widen THAT container/row directly and make it "fluid core + fixed panel".
   ========================= */

@media (min-width: 1200px){
  /* widen the actual page container used on list/about pages */
  #main-wrapper{
    width: 100% !important;
  }

  #main-wrapper > .container{
    width: 100% !important;
    max-width: 1480px !important; /* tweak 1440~1600 */
  }
}

@media (min-width: 992px){
  /* main layout row */
  #main-wrapper > .container > .row.flex-grow-1{
    width: 100% !important;
    flex-wrap: nowrap !important;
    align-items: flex-start !important;
  }

  /* core area on list/about pages */
  #main-wrapper > .container > .row.flex-grow-1 > main[aria-label="Main Content"]{
    flex: 1 1 0% !important;
    width: auto !important;
    max-width: none !important;
    min-width: 0 !important;
  }

  /* panel pinned to the far right */
  #main-wrapper > .container > .row.flex-grow-1 > aside#panel-wrapper{
    margin-left: auto !important;
    flex: 0 0 320px !important;
    width: 320px !important;
    max-width: 320px !important;
    min-width: 320px !important;
  }
}

/* =========================
   v8: TOC not sticking (use the real element: section#toc-wrapper)
   ========================= */
@media (min-width: 992px){
  /* Ensure no ancestor kills sticky */
  #main-wrapper,
  #main-wrapper > .container,
  aside#panel-wrapper{
    overflow: visible !important;
  }

  section#toc-wrapper{
    position: sticky !important;
    top: 5.2rem !important;
    max-height: calc(100vh - 6.2rem);
    overflow-y: auto;
    z-index: 20;
  }
}
